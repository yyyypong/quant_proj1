<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高性能多因子量化策略 - WorldQuant比赛方案</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1>高性能多因子量化策略</h1>
            <p class="subtitle">年年正收益 · 高收益率 · 低波动率</p>
            <div class="header-stats">
                <div class="stat">
                    <span class="stat-value">36.61%</span>
                    <span class="stat-label">年化收益率</span>
                </div>
                <div class="stat">
                    <span class="stat-value">11.78%</span>
                    <span class="stat-label">波动率</span>
                </div>
                <div class="stat">
                    <span class="stat-value">3.11</span>
                    <span class="stat-label">夏普比率</span>
                </div>
                <div class="stat">
                    <span class="stat-value">100%</span>
                    <span class="stat-label">正收益年份</span>
                </div>
            </div>
        </div>
    </header>

    <nav>
        <div class="container">
            <ul>
                <li><a href="#strategy-overview">策略概述</a></li>
                <li><a href="#factor-model">多因子模型</a></li>
                <li><a href="#ml-optimization">机器学习优化</a></li>
                <li><a href="#timing-strategy">择时策略</a></li>
                <li><a href="#risk-control">风险控制</a></li>
                <li><a href="#backtest-results">回测结果</a></li>
                <li><a href="#code-implementation">代码实现</a></li>
            </ul>
        </div>
    </nav>

    <section id="strategy-overview" class="section-alt">
        <div class="container">
            <h2>策略概述</h2>
            <div class="overview-grid">
                <div class="overview-text">
                    <p>本策略是一个专为WorldQuant比赛设计的高性能多因子量化投资方案，旨在实现<strong>年年正收益</strong>、<strong>高收益率</strong>和<strong>低波动率</strong>三大目标。</p>
                    <p>通过整合四大核心组件：优化的多因子选股模型、机器学习因子优化、改进版RSRS择时策略和增强型风险控制，该策略在2023-2024年回测期间实现了<strong>36.61%的年化收益率</strong>，显著超越基准指数（10.31%），同时保持较低的波动率（11.78%，低于基准的13.70%）和较小的最大回撤（-6.11%）。</p>
                    <p>最重要的是，该策略成功实现了年年正收益的目标，展现出卓越的风险调整后收益和稳定性。</p>
                </div>
                <div class="overview-image">
                    <img src="results/performance_chart.png" alt="策略性能图表">
                </div>
            </div>
            <div class="key-features">
                <div class="feature">
                    <div class="feature-icon">📈</div>
                    <h3>高收益率</h3>
                    <p>年化收益率36.61%，超越基准26.30个百分点</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">📊</div>
                    <h3>低波动率</h3>
                    <p>波动率仅为11.78%，低于基准的13.70%</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">🛡️</div>
                    <h3>小回撤</h3>
                    <p>最大回撤仅为-6.11%，远低于基准的-14.65%</p>
                </div>
                <div class="feature">
                    <div class="feature-icon">🔄</div>
                    <h3>年年正收益</h3>
                    <p>100%正收益年份，实现稳定增长</p>
                </div>
            </div>
        </div>
    </section>

    <section id="factor-model">
        <div class="container">
            <h2>多因子模型</h2>
            <div class="factor-grid">
                <div class="factor-category">
                    <h3>价值因子</h3>
                    <ul>
                        <li><strong>EBIT/EV</strong>：企业价值收益率，衡量公司盈利能力相对于其企业价值的效率</li>
                        <li><strong>P/B倒数</strong>：账面价值与市值比率，识别相对于账面价值被低估的股票</li>
                        <li><strong>FCF/Price</strong>：自由现金流收益率，评估公司产生现金流的能力</li>
                    </ul>
                </div>
                <div class="factor-category">
                    <h3>质量因子</h3>
                    <ul>
                        <li><strong>ROE</strong>：净资产收益率，衡量公司利用股东权益创造利润的能力</li>
                        <li><strong>资产负债率</strong>：评估公司的财务杠杆和风险水平</li>
                        <li><strong>毛利率稳定性</strong>：衡量公司盈利能力的一致性和可预测性</li>
                    </ul>
                </div>
                <div class="factor-category">
                    <h3>动量因子</h3>
                    <ul>
                        <li><strong>6个月价格动量</strong>：捕捉中期价格趋势</li>
                        <li><strong>相对强弱指标(RSI)</strong>：识别超买超卖状态</li>
                        <li><strong>均线交叉信号</strong>：捕捉短期价格趋势变化</li>
                    </ul>
                </div>
                <div class="factor-category">
                    <h3>低波动因子</h3>
                    <ul>
                        <li><strong>60日波动率倒数</strong>：偏好低波动股票，提高组合稳定性</li>
                        <li><strong>贝塔系数倒数</strong>：降低对市场系统性风险的敏感度</li>
                        <li><strong>最大回撤倒数</strong>：避免历史上有大幅下跌的股票</li>
                    </ul>
                </div>
            </div>
            <div class="factor-process">
                <h3>因子处理流程</h3>
                <div class="process-steps">
                    <div class="process-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>去极值</h4>
                            <p>采用中位数绝对偏差(MAD)方法，将超出3倍MAD的值替换为边界值</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>缺失值处理</h4>
                            <p>对于缺失率低于20%的因子，使用行业中位数填充；对于缺失率高的因子，使用机器学习模型预测</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>标准化</h4>
                            <p>将因子转换为均值为0、标准差为1的标准正态分布</p>
                        </div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>中性化</h4>
                            <p>通过线性回归消除行业和市值因素的影响，提取因子的纯alpha信息</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="ml-optimization" class="section-alt">
        <div class="container">
            <h2>机器学习因子优化</h2>
            <div class="ml-grid">
                <div class="ml-image">
                    <img src="results/performance_metrics.png" alt="机器学习优化流程">
                </div>
                <div class="ml-content">
                    <h3>XGBoost模型优势</h3>
                    <ul>
                        <li>能够捕捉因子间的非线性关系</li>
                        <li>自动处理特征重要性</li>
                        <li>对异常值不敏感</li>
                        <li>内置正则化机制，避免过拟合</li>
                    </ul>
                    
                    <h3>特征工程</h3>
                    <ul>
                        <li>原始因子值</li>
                        <li>因子历史Z-score</li>
                        <li>因子动量（变化率）</li>
                        <li>因子波动率</li>
                        <li>因子间交叉项</li>
                    </ul>
                    
                    <h3>训练流程</h3>
                    <ol>
                        <li>使用滚动窗口法，每次使用过去12个月数据训练模型</li>
                        <li>应用5折交叉验证优化超参数</li>
                        <li>计算特征重要性，动态调整因子权重</li>
                        <li>生成下一个月的预测收益率</li>
                    </ol>
                </div>
            </div>
            <div class="feature-importance">
                <h3>因子重要性分析</h3>
                <div class="chart-container">
                    <canvas id="featureImportanceChart"></canvas>
                </div>
            </div>
        </div>
    </section>

    <section id="timing-strategy">
        <div class="container">
            <h2>改进版RSRS择时策略</h2>
            <div class="timing-grid">
                <div class="timing-content">
                    <h3>RSRS指标原理</h3>
                    <p>RSRS（阻力支撑相对强度）指标基于股价的高低点线性回归斜率，通过计算斜率的标准分，判断市场强弱。</p>
                    
                    <h3>改进措施</h3>
                    <ul>
                        <li><strong>钝化处理</strong>：引入20日移动平均对RSRS信号进行平滑，减少震荡市场中的误判</li>
                        <li><strong>波动率调整</strong>：将RSRS信号与市场波动率相结合，在高波动环境下降低信号敏感度</li>
                        <li><strong>多级信号系统</strong>：设置多个阈值（-1.0, -0.5, 0, 0.5, 1.0），实现更精细的仓位控制</li>
                    </ul>
                    
                    <h3>择时效果</h3>
                    <ul>
                        <li>成功避开了主要的市场下跌</li>
                        <li>在上涨趋势中保持较高仓位</li>
                        <li>显著降低了最大回撤（从-14.65%降至-6.11%）</li>
                        <li>提高了风险调整后收益（夏普比率从0.75提升至3.11）</li>
                    </ul>
                </div>
                <div class="timing-image">
                    <img src="results/yearly_returns.png" alt="RSRS择时策略">
                </div>
            </div>
            <div class="position-chart">
                <h3>市场仓位变化</h3>
                <div class="chart-container">
                    <canvas id="positionChart"></canvas>
                </div>
            </div>
        </div>
    </section>

    <section id="risk-control" class="section-alt">
        <div class="container">
            <h2>增强型风险控制</h2>
            <div class="risk-grid">
                <div class="risk-image">
                    <img src="results/performance_chart.png" alt="风险控制">
                </div>
                <div class="risk-content">
                    <h3>ES风险度量</h3>
                    <p>Expected Shortfall (ES)作为VaR的改进版，能够更好地评估尾部风险：</p>
                    <ul>
                        <li>计算特定置信水平下的平均损失</li>
                        <li>对极端事件更敏感</li>
                        <li>满足风险度量的次可加性</li>
                    </ul>
                    
                    <h3>风险平价配置</h3>
                    <p>风险平价原则确保各资产对组合总风险的贡献相等，实现更均衡的风险分配。</p>
                    
                    <h3>动态风险管理</h3>
                    <ol>
                        <li><strong>波动率目标机制</strong>：根据市场环境动态调整目标波动率</li>
                        <li><strong>条件风险平价</strong>：在不同市场状态下调整风险分配策略</li>
                        <li><strong>止损机制</strong>：设置组合和个股层面的止损阈值</li>
                        <li><strong>压力测试</strong>：定期进行历史和假设情景下的压力测试</li>
                    </ol>
                </div>
            </div>
        </div>
    </section>

    <section id="backtest-results">
        <div class="container">
            <h2>回测结果</h2>
            <div class="results-summary">
                <div class="results-table">
                    <h3>关键指标对比</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>指标</th>
                                <th>策略</th>
                                <th>基准</th>
                                <th>相对表现</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>年化收益率</td>
                                <td class="highlight">36.61%</td>
                                <td>10.31%</td>
                                <td class="positive">+26.30%</td>
                            </tr>
                            <tr>
                                <td>波动率</td>
                                <td class="highlight">11.78%</td>
                                <td>13.70%</td>
                                <td class="positive">-1.92%</td>
                            </tr>
                            <tr>
                                <td>夏普比率</td>
                                <td class="highlight">3.11</td>
                                <td>0.75</td>
                                <td class="positive">+2.36</td>
                            </tr>
                            <tr>
                                <td>最大回撤</td>
                                <td class="highlight">-6.11%</td>
                                <td>-14.65%</td>
                                <td class="positive">+8.54%</td>
                            </tr>
                            <tr>
                                <td>卡玛比率</td>
                                <td class="highlight">5.99</td>
                                <td>0.70</td>
                                <td class="positive">+5.29</td>
                            </tr>
                            <tr>
                                <td>胜率</td>
                                <td>54.60%</td>
                                <td>54.02%</td>
                                <td class="positive">+0.58%</td>
                            </tr>
                            <tr>
                                <td>正收益月份</td>
                                <td class="highlight">86.96%</td>
                                <td>47.83%</td>
                                <td class="positive">+39.13%</td>
                            </tr>
                            <tr>
                                <td>正收益年份</td>
                                <td class="highlight">100.00%</td>
                                <td>100.00%</td>
                                <td>0.00%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="results-charts">
                    <div class="chart-container">
                        <h3>年度收益对比</h3>
                        <canvas id="yearlyReturnsChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>月度收益热图</h3>
                        <img src="results/monthly_returns.png" alt="月度收益热图">
                    </div>
                </div>
            </div>
            <div class="performance-metrics">
                <h3>性能指标可视化</h3>
                <img src="results/performance_metrics.png" alt="性能指标对比">
            </div>
        </div>
    </section>

    <section id="code-implementation" class="section-alt">
        <div class="container">
            <h2>代码实现</h2>
            <div class="code-tabs">
                <div class="tab-buttons">
                    <button class="tab-button active" data-tab="factor-code">多因子模型</button>
                    <button class="tab-button" data-tab="ml-code">机器学习优化</button>
                    <button class="tab-button" data-tab="timing-code">RSRS择时</button>
                    <button class="tab-button" data-tab="risk-code">风险控制</button>
                </div>
                <div class="tab-content">
                    <div class="tab-pane active" id="factor-code">
                        <pre><code class="language-python">class MultifactorModel:
    def __init__(self):
        self.factors = {
            'value': ['ebit_ev', 'pb_inverse', 'fcf_price'],
            'quality': ['roe', 'debt_equity', 'gross_margin_stability'],
            'momentum': ['price_momentum_6m', 'rsi', 'ma_crossover'],
            'low_volatility': ['volatility_60d_inverse', 'beta_inverse', 'max_drawdown_inverse']
        }
        
    def calculate_factors(self, stock_data, financial_data):
        """计算所有因子"""
        factor_data = {}
        
        # 计算价值因子
        factor_data['ebit_ev'] = self._calculate_ebit_ev(financial_data)
        factor_data['pb_inverse'] = 1 / financial_data['pb_ratio']
        factor_data['fcf_price'] = financial_data['free_cash_flow'] / stock_data['market_cap']
        
        # 计算质量因子
        factor_data['roe'] = financial_data['net_income'] / financial_data['total_equity']
        factor_data['debt_equity'] = financial_data['total_debt'] / financial_data['total_equity']
        factor_data['gross_margin_stability'] = self._calculate_stability(financial_data['gross_margin'])
        
        # 计算动量因子
        factor_data['price_momentum_6m'] = self._calculate_momentum(stock_data['close'], 126)
        factor_data['rsi'] = self._calculate_rsi(stock_data['close'], 14)
        factor_data['ma_crossover'] = self._calculate_ma_crossover(stock_data['close'])
        
        # 计算低波动因子
        factor_data['volatility_60d_inverse'] = 1 / self._calculate_volatility(stock_data['return'], 60)
        factor_data['beta_inverse'] = 1 / self._calculate_beta(stock_data['return'], market_return)
        factor_data['max_drawdown_inverse'] = 1 / self._calculate_max_drawdown(stock_data['close'])
        
        return factor_data</code></pre>
                    </div>
                    <div class="tab-pane" id="ml-code">
                        <pre><code class="language-python">class MLFactorOptimization:
    def __init__(self, lookback_period=12, prediction_period=1):
        self.lookback_period = lookback_period  # 月
        self.prediction_period = prediction_period  # 月
        self.model = None
        
    def prepare_features(self, factor_data, returns):
        """准备特征和标签"""
        features = []
        labels = []
        
        for i in range(self.lookback_period, len(returns) - self.prediction_period):
            # 特征：过去lookback_period个月的因子数据
            feature_window = factor_data.iloc[i-self.lookback_period:i]
            
            # 特征工程
            feature_vector = self._engineer_features(feature_window)
            features.append(feature_vector)
            
            # 标签：未来prediction_period个月的收益
            future_return = returns.iloc[i:i+self.prediction_period].mean()
            labels.append(future_return)
        
        return np.array(features), np.array(labels)</code></pre>
                    </div>
                    <div class="tab-pane" id="timing-code">
                        <pre><code class="language-python">def calculate_rsrs_signal(high_prices, low_prices, n=18, m=600, sigma=0.1):
    """计算改进版RSRS择时信号"""
    # 计算N日线性回归斜率序列
    slopes = []
    r_squared = []
    for i in range(n-1, len(high_prices)):
        high_segment = high_prices[i-n+1:i+1]
        low_segment = low_prices[i-n+1:i+1]
        x = np.arange(n).reshape(-1, 1)
        
        # 计算高低点线性回归
        model = LinearRegression()
        model.fit(x, high_segment / low_segment)
        slopes.append(model.coef_[0])
        r_squared.append(model.score(x, high_segment / low_segment))
    
    slopes = np.array(slopes)
    r_squared = np.array(r_squared)
    
    # 计算RSRS标准分
    rsrs_std = []
    for i in range(m, len(slopes)):
        mean = np.mean(slopes[i-m:i])
        std = np.std(slopes[i-m:i])
        rsrs_std.append((slopes[i] - mean) / std)
    
    # 计算RSRS修正标准分
    rsrs_modified = np.array(rsrs_std) * np.array(r_squared[-len(rsrs_std):])
    
    # 计算钝化RSRS指标 (20日移动平均)
    rsrs_smoothed = np.convolve(rsrs_modified, np.ones(20)/20, mode='valid')
    
    # 生成择时信号
    signals = []
    for value in rsrs_smoothed:
        if value > 1.0:
            signals.append(100)  # 满仓
        elif value > 0.5:
            signals.append(80)   # 8成仓
        elif value > 0:
            signals.append(60)   # 6成仓
        elif value > -0.5:
            signals.append(40)   # 4成仓
        elif value > -1.0:
            signals.append(20)   # 2成仓
        else:
            signals.append(0)    # 空仓
    
    return signals</code></pre>
                    </div>
                    <div class="tab-pane" id="risk-code">
                        <pre><code class="language-python">class RiskParityPortfolio:
    def __init__(self, returns, risk_measure='variance'):
        self.returns = returns
        self.risk_measure = risk_measure
        self.n_assets = returns.shape[1]
        
    def optimize(self, target_risk=None, max_iter=1000, tol=1e-8):
        """优化风险平价组合"""
        # 初始权重
        weights = np.ones(self.n_assets) / self.n_assets
        
        if self.risk_measure == 'variance':
            # 计算协方差矩阵
            cov_matrix = np.cov(self.returns.T)
            weights = self._optimize_variance_risk_parity(cov_matrix, target_risk, max_iter, tol)
        
        elif self.risk_measure == 'expected_shortfall':
            weights = self._optimize_es_risk_parity(target_risk, max_iter, tol)
        
        else:
            raise ValueError(f"Unsupported risk measure: {self.risk_measure}")
        
        return weights</code></pre>
                    </div>
                </div>
            </div>
            <div class="download-section">
                <h3>完整代码下载</h3>
                <div class="download-buttons">
                    <a href=" " class="download-button">下载完整代码包(under construction 策略暂未公开)</a>
                    <a href="final_report.md" class="download-button">下载详细报告</a>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-info">
                    <h3>高性能多因子量化策略</h3>
                    <p>ALL BY YYYYPONG.</p>
                    <p>All Rights Reserved.</p>
                </div>
                <div class="footer-links">
                    <h3>快速导航</h3>
                    <ul>
                        <li><a href="#strategy-overview">策略概述</a></li>
                        <li><a href="#factor-model">多因子模型</a></li>
                        <li><a href="#ml-optimization">机器学习优化</a></li>
                        <li><a href="#timing-strategy">择时策略</a></li>
                        <li><a href="#risk-control">风险控制</a></li>
                        <li><a href="#backtest-results">回测结果</a></li>
                        <li><a href="#code-implementation">代码实现</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h3>联系方式</h3>
                    <p>如有任何问题或建议，请随时联系</p>
                    <p>邮箱：yympong@connect.ust.hk</p>
                    <p>vx：yaozilv1dian</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 高性能多因子量化策略 yyyypong. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/interactive.js"></script>
</body>
</html>
